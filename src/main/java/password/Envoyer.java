/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package password;

/**
 *
 * @author zhanghuakai
 */
import javax.mail.Session;
import javax.mail.Transport;
import javax.mail.internet.InternetAddress;
import javax.mail.internet.MimeMessage;
import java.util.Date;
import java.util.Properties;

/**
 * JavaMail ??: 1.6.0 JDK ??: JDK 1.7 ??????
 */
public class Envoyer {

    // ???? ?? ? ???????????????
    // PS: ??????????????????????? SMTP ?????????????????“???”?, 
    //     ????????????, ???????????????????????
    public static String myEmailAccount = "zhanghuakai1234@gmail.com";
    public static String myEmailPassword = "zhk067185";

    // ?????? SMTP ?????, ????, ???????????, ??(????, ????)???: smtp.xxx.com
    // ??163??? SMTP ??????: smtp.163.com
    public static String myEmailSMTPHost = "smtp.gmail.com";

    // ???????????????????
    //public static String receiveMailAccount = "zhanghuakai1234@gmail.com";
    public static void mail(String mail, String pass) throws Exception {
        String receiveMailAccount = mail;
        // 1. ??????, ??????????????
        Properties props = new Properties();                    // ????
        props.setProperty("mail.transport.protocol", "smtp");   // ??????JavaMail?????
        props.setProperty("mail.smtp.host", myEmailSMTPHost);   // ??????? SMTP ?????
        props.setProperty("mail.smtp.auth", "true");            // ??????

        // PS: ????????? SMTP ?????? SSL ???? (???????, ????SSL??, ???????),
        //     ???????????, ?????????? log, ?????? “????, ?? SSL ????” ???,
        //     ???? /* ... */ ???????, ?? SSL ?????
        /*
        // SMTP ?????? (? SSL ?????????? 25, ?????, ????? SSL ??,
        //                  ????????? SMTP ??????, ??????????????,
        //                  QQ???SMTP(SLL)???465?587, ?????????)
        final String smtpPort = "465";
        props.setProperty("mail.smtp.port", smtpPort);
        props.setProperty("mail.smtp.socketFactory.class", "javax.net.ssl.SSLSocketFactory");
        props.setProperty("mail.smtp.socketFactory.fallback", "false");
        props.setProperty("mail.smtp.socketFactory.port", smtpPort);
         */
        // 2. ??????????, ??????????
        Session session = Session.getInstance(props);
        session.setDebug(true);                                 // ???debug??, ????????? log

        // 3. ??????
        MimeMessage message = createMimeMessage(session, myEmailAccount, receiveMailAccount);

        // 4. ?? Session ????????
        Transport transport = session.getTransport();

        // 5. ?? ???? ? ?? ???????, ?????????? message ?????????, ????
        // 
        //    PS_01: ???????????, ?????????, ??????????????? log,
        //           ????????, ???????????????????????, ???????
        //           ?????????????????????????
        //
        //    PS_02: ??????????????, ??????:
        //           (1) ?????? SMTP ??;
        //           (2) ??????, ?????????????;
        //           (3) ???????????? SSL ????;
        //           (4) ???????????, ??????????;
        //           (5) ???????????, ?????????????
        //
        //    PS_03: ???log, ???log, ??log, ??????log????
        transport.connect(myEmailAccount, myEmailPassword);

        // 6. ????, ?????????, message.getAllRecipients() ?????????????????????, ???, ???
        transport.sendMessage(message, message.getAllRecipients());

        // 7. ????
        transport.close();
    }

    /**
     * ??????????????
     *
     * @param session ?????????
     * @param sendMail ?????
     * @param receiveMail ?????
     * @return
     * @throws Exception
     */
    public static MimeMessage createMimeMessage(Session session, String sendMail, String receiveMail) throws Exception {
        // 1. ??????
        MimeMessage message = new MimeMessage(session);

        // 2. From: ?????????????????????????????????????????
        message.setFrom(new InternetAddress(sendMail, "???", "UTF-8"));

        // 3. To: ????????????????????
        message.setRecipient(MimeMessage.RecipientType.TO, new InternetAddress(receiveMail, "XX??", "UTF-8"));

        // 4. Subject: ??????????????????????????????????????????
        message.setSubject("????", "UTF-8");

        // 5. Content: ?????????html???????????????????????????????????????????
        message.setContent("XX????, ????5?, ????, ???????????", "text/html;charset=UTF-8");

        // 6. ??????
        message.setSentDate(new Date());

        // 7. ????
        message.saveChanges();

        return message;
    }

}
